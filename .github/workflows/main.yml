name: Run Unit Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
    
    runs-on: ${{ matrix.os }}
    timeout-minutes: 10
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Display project structure
      run: |
        echo "=== Project Structure ==="
        dir
        echo "=== Checking folders ==="
        python -c "
        import os
        folders = ['circle', 'rectangle', 'square', 'triangle']
        for folder in folders:
            if os.path.exists(folder):
                print(f'{folder}/ exists:')
                for item in os.listdir(folder):
                    print(f'  {item}')
            else:
                print(f'{folder}/ - NOT FOUND')
        "
    
    - name: Create __init__.py files
      run: |
        python -c "
        import os
        folders = ['circle', 'rectangle', 'square', 'triangle']
        for folder in folders:
            if os.path.exists(folder):
                init_file = os.path.join(folder, '__init__.py')
                with open(init_file, 'w') as f:
                    f.write('# Init file')
                print(f'Created {init_file}')
        "
    
    - name: Run Python tests
      run: |
        python -c "
        import sys
        import os
        
        print('=== Testing Shapes ===')
        
        # Test Circle
        print('1. Testing Circle:')
        try:
            sys.path.insert(0, 'circle')
            from circle import area, perimeter
            circle_area = area(5)
            circle_peri = perimeter(5)
            print('   Circle area(5) =', circle_area)
            print('   Circle perimeter(5) =', circle_peri)
            print('   SUCCESS: Circle tests passed')
        except Exception as e:
            print('   ERROR: Circle failed -', str(e))
        
        # Test Rectangle
        print('2. Testing Rectangle:')
        try:
            sys.path.insert(0, 'rectangle')
            from rectangle import area, perimeter
            rect_area = area(4, 6)
            rect_peri = perimeter(4, 6)
            print('   Rectangle area(4,6) =', rect_area)
            print('   Rectangle perimeter(4,6) =', rect_peri)
            print('   SUCCESS: Rectangle tests passed')
        except Exception as e:
            print('   ERROR: Rectangle failed -', str(e))
        
        # Test Square
        print('3. Testing Square:')
        try:
            sys.path.insert(0, 'square')
            from square import area, perimeter
            square_area = area(4)
            square_peri = perimeter(4)
            print('   Square area(4) =', square_area)
            print('   Square perimeter(4) =', square_peri)
            print('   SUCCESS: Square tests passed')
        except Exception as e:
            print('   ERROR: Square failed -', str(e))
        
        # Test Triangle
        print('4. Testing Triangle:')
        try:
            sys.path.insert(0, 'triangle')
            from triangle import area, perimeter
            tri_area = area(6, 4)
            tri_peri = perimeter(3, 4, 5)
            print('   Triangle area(6,4) =', tri_area)
            print('   Triangle perimeter(3,4,5) =', tri_peri)
            print('   SUCCESS: Triangle tests passed')
        except Exception as e:
            print('   ERROR: Triangle failed -', str(e))
        
        print('=== All tests completed ===')
        "